{"version":3,"sources":["../../../src/infrastructure/service/prisma.service.ts"],"sourcesContent":["import {\n  BadGatewayException,\n  Injectable,\n  OnModuleDestroy,\n  OnModuleInit,\n} from '@nestjs/common';\nimport { Prisma, PrismaClient } from '@prisma/client';\n\nimport { CustomLogger } from '../../utility';\n\n@Injectable()\nexport class PrismaService\n  extends PrismaClient\n  implements OnModuleInit, OnModuleDestroy\n{\n  constructor(readonly logger: CustomLogger) {\n    super();\n  }\n\n  async onModuleInit() {\n    await this.$connect();\n  }\n\n  async onModuleDestroy() {\n    await this.$disconnect();\n  }\n\n  setLoggerContext(context: string) {\n    this.logger.setContext(context);\n  }\n\n  async handleError<T>(operation: () => T): Promise<Awaited<T>> {\n    try {\n      return await operation();\n    } catch (error) {\n      this.logger.error(error);\n\n      if (error instanceof Prisma.PrismaClientKnownRequestError) {\n        throw new BadGatewayException(`${error.code}: ${error.message}`);\n      }\n\n      throw new BadGatewayException(error.message);\n    }\n  }\n}\n"],"names":["BadGatewayException","Injectable","Prisma","PrismaClient","CustomLogger","PrismaService","onModuleInit","$connect","onModuleDestroy","$disconnect","setLoggerContext","context","logger","setContext","handleError","operation","error","PrismaClientKnownRequestError","code","message","constructor"],"mappings":";;;;;;;;;AAAA,SACEA,mBAAmB,EACnBC,UAAU,QAGL,iBAAiB;AACxB,SAASC,MAAM,EAAEC,YAAY,QAAQ,iBAAiB;AAEtD,SAASC,YAAY,QAAQ,yBAAgB;AAG7C,OAAO,MAAMC,sBACHF;IAOR,MAAMG,eAAe;QACnB,MAAM,IAAI,CAACC,QAAQ;IACrB;IAEA,MAAMC,kBAAkB;QACtB,MAAM,IAAI,CAACC,WAAW;IACxB;IAEAC,iBAAiBC,OAAe,EAAE;QAChC,IAAI,CAACC,MAAM,CAACC,UAAU,CAACF;IACzB;IAEA,MAAMG,YAAeC,SAAkB,EAAuB;QAC5D,IAAI;YACF,OAAO,MAAMA;QACf,EAAE,OAAOC,OAAO;YACd,IAAI,CAACJ,MAAM,CAACI,KAAK,CAACA;YAElB,IAAIA,iBAAiBd,OAAOe,6BAA6B,EAAE;gBACzD,MAAM,IAAIjB,oBAAoB,GAAGgB,MAAME,IAAI,CAAC,EAAE,EAAEF,MAAMG,OAAO,EAAE;YACjE;YAEA,MAAM,IAAInB,oBAAoBgB,MAAMG,OAAO;QAC7C;IACF;IA5BAC,YAAY,AAASR,MAAoB,CAAE;QACzC,KAAK,SADcA,SAAAA;IAErB;AA2BF"}