{"version":3,"sources":["../../../../src/application/scenario/project-status-update-report/parser.ts"],"sourcesContent":["import { BadRequestException } from '@nestjs/common';\n\nimport {\n  File,\n  IUpdateProjectStatusUpdateReport,\n  ProjectStatusUpdateReport,\n} from '../../../domain/entity';\nimport {\n  CreateUserId,\n  FileName,\n  FilePath,\n  ProjectId,\n  ProjectReportId,\n  ProjectStatusCode,\n  ReportText,\n  Title,\n  UploadUserId,\n  YearMonthDay,\n} from '../../../domain/value';\nimport { CustomLogger } from '../../../utility';\nimport {\n  ICreateProjectStatusUpdateReportRequest,\n  IProjectStatusUpdateReportResponse,\n  IUpdateProjectStatusUpdateReportRequest,\n} from '../../interface';\n\nexport class ProjectStatusUpdateReportParser {\n  constructor(readonly logger: CustomLogger) {}\n\n  convertToProjectReport(\n    input: ICreateProjectStatusUpdateReportRequest,\n  ): ProjectStatusUpdateReport {\n    try {\n      const id = ProjectReportId.make();\n      const createUserId = CreateUserId.make();\n      const reportDate = YearMonthDay.from(input.report_date);\n      const projectId = ProjectId.from(input.project_id);\n      const uploadUserId = UploadUserId.from(createUserId.value);\n      const files = input.attached_files.map(\n        (file) =>\n          new File({\n            name: FileName.from(file.file_name),\n            path: FilePath.from(file.file_path),\n            uploadUserId,\n          }),\n      );\n      const title = Title.from(input.title ?? null);\n      const reportText = ReportText.from(input.report_text ?? null);\n      const projectStatusCode = ProjectStatusCode.from(\n        input.project_status_code,\n      );\n\n      return new ProjectStatusUpdateReport({\n        id,\n        createUserId,\n        reportDate,\n        projectId,\n        files,\n        title,\n        reportText,\n        projectStatusCode,\n      });\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.message);\n    }\n  }\n\n  convertProjectReportToReference(\n    entity: ProjectStatusUpdateReport,\n  ): IProjectStatusUpdateReportResponse {\n    const {\n      id,\n      files,\n      projectId,\n      reportDate,\n      createUserId,\n      title,\n      reportText,\n      projectStatusCode,\n    } = entity;\n\n    return {\n      id: id.value,\n      title: title.value ?? undefined,\n      report_text: reportText.value ?? undefined,\n      attached_files: files.map((file) => ({\n        file_name: file.name.value,\n        file_path: file.path.value,\n      })),\n      report_date: reportDate.toString(),\n      create_user_id: createUserId.value,\n      project_status_code: projectStatusCode.value,\n      project_id: projectId.value,\n    };\n  }\n  private returnValueOrUndefined<E, T>(\n    value: E,\n    operation: (value: E) => T,\n  ): T | undefined {\n    if (value === undefined) {\n      return undefined;\n    }\n    return operation(value);\n  }\n  formatDataToUpdate(\n    userId: string,\n    data: IUpdateProjectStatusUpdateReportRequest,\n  ): IUpdateProjectStatusUpdateReport {\n    const uploadUserId = UploadUserId.from(userId);\n    return {\n      files: data.attached_files?.map(\n        (file) =>\n          new File({\n            name: FileName.from(file.file_name),\n            path: FilePath.from(file.file_path),\n            uploadUserId,\n          }),\n      ),\n      title: this.returnValueOrUndefined(data.title, Title.from),\n      reportText: this.returnValueOrUndefined(\n        data.report_text,\n        ReportText.from,\n      ),\n\n      projectStatusCode: this.returnValueOrUndefined(\n        data.project_status_code,\n        ProjectStatusCode.from,\n      ),\n      reportDate: this.returnValueOrUndefined(\n        data.report_date,\n        YearMonthDay.from,\n      ),\n    };\n  }\n}\n"],"names":["BadRequestException","File","ProjectStatusUpdateReport","CreateUserId","FileName","FilePath","ProjectId","ProjectReportId","ProjectStatusCode","ReportText","Title","UploadUserId","YearMonthDay","ProjectStatusUpdateReportParser","convertToProjectReport","input","id","make","createUserId","reportDate","from","report_date","projectId","project_id","uploadUserId","value","files","attached_files","map","file","name","file_name","path","file_path","title","reportText","report_text","projectStatusCode","project_status_code","error","logger","message","convertProjectReportToReference","entity","undefined","toString","create_user_id","returnValueOrUndefined","operation","formatDataToUpdate","userId","data","constructor"],"mappings":"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"}