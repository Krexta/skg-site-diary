{"version":3,"sources":["../../../../src/application/scenario/project-close-report/scenario.ts"],"sourcesContent":["import {\n  BadGatewayException,\n  BadRequestException,\n  Injectable,\n  InternalServerErrorException,\n  NotFoundException,\n} from '@nestjs/common';\n\nimport { ReportRepository } from '../../../domain/repository';\nimport { ProjectReportId } from '../../../domain/value';\nimport { CustomLogger } from '../../../utility';\nimport {\n  ICreateProjectCloseReportRequest,\n  IProjectCloseReportResponse,\n  IUpdateProjectCloseReportRequest,\n} from '../../interface';\n\nimport { ProjectCloseReportParser } from './parser';\n\n@Injectable()\nexport class ProjectCloseReportScenario {\n  readonly parser: ProjectCloseReportParser;\n\n  constructor(\n    readonly logger: CustomLogger,\n    readonly repository: ReportRepository,\n  ) {\n    this.logger.setContext(ProjectCloseReportScenario.name);\n    this.parser = new ProjectCloseReportParser(this.logger);\n  }\n\n  async pushProjectCloseReport(\n    input: ICreateProjectCloseReportRequest,\n  ): Promise<IProjectCloseReportResponse> {\n    try {\n      const entity = this.parser.convertToProjectReport(input);\n\n      const result = await this.repository.createProjectCloseReport(entity);\n\n      return this.parser.convertProjectReportToReference(result);\n    } catch (error) {\n      if (\n        [BadRequestException, BadGatewayException].includes(error.constructor)\n      ) {\n        throw error;\n      }\n\n      this.logger.error(error);\n      throw new InternalServerErrorException(error.message);\n    }\n  }\n\n  async update(\n    id: string,\n    updateData: IUpdateProjectCloseReportRequest,\n  ): Promise<IProjectCloseReportResponse> {\n    try {\n      const entity = await this.repository.getProjectCloseReportById(\n        ProjectReportId.from(id),\n      );\n\n      const data = this.parser.formatDataToUpdate(\n        entity.createUserId.value,\n        updateData,\n      );\n      const updatedEntity = entity.update(data);\n\n      const result =\n        await this.repository.updateProjectCloseReport(updatedEntity);\n\n      return this.parser.convertProjectReportToReference(result);\n    } catch (error) {\n      if (\n        [BadRequestException, BadGatewayException, NotFoundException].includes(\n          error.constructor,\n        )\n      ) {\n        throw error;\n      }\n\n      this.logger.error(error);\n      throw new InternalServerErrorException(error.message);\n    }\n  }\n}\n"],"names":["BadGatewayException","BadRequestException","Injectable","InternalServerErrorException","NotFoundException","ReportRepository","ProjectReportId","CustomLogger","ProjectCloseReportParser","ProjectCloseReportScenario","pushProjectCloseReport","input","entity","parser","convertToProjectReport","result","repository","createProjectCloseReport","convertProjectReportToReference","error","includes","constructor","logger","message","update","id","updateData","getProjectCloseReportById","from","data","formatDataToUpdate","createUserId","value","updatedEntity","updateProjectCloseReport","setContext","name"],"mappings":";;;;;;;;;AAAA,SACEA,mBAAmB,EACnBC,mBAAmB,EACnBC,UAAU,EACVC,4BAA4B,EAC5BC,iBAAiB,QACZ,iBAAiB;AAExB,SAASC,gBAAgB,QAAQ,sCAA6B;AAC9D,SAASC,eAAe,QAAQ,iCAAwB;AACxD,SAASC,YAAY,QAAQ,4BAAmB;AAOhD,SAASC,wBAAwB,QAAQ,cAAW;AAGpD,OAAO,MAAMC;IAWX,MAAMC,uBACJC,KAAuC,EACD;QACtC,IAAI;YACF,MAAMC,SAAS,IAAI,CAACC,MAAM,CAACC,sBAAsB,CAACH;YAElD,MAAMI,SAAS,MAAM,IAAI,CAACC,UAAU,CAACC,wBAAwB,CAACL;YAE9D,OAAO,IAAI,CAACC,MAAM,CAACK,+BAA+B,CAACH;QACrD,EAAE,OAAOI,OAAO;YACd,IACE;gBAAClB;gBAAqBD;aAAoB,CAACoB,QAAQ,CAACD,MAAME,WAAW,GACrE;gBACA,MAAMF;YACR;YAEA,IAAI,CAACG,MAAM,CAACH,KAAK,CAACA;YAClB,MAAM,IAAIhB,6BAA6BgB,MAAMI,OAAO;QACtD;IACF;IAEA,MAAMC,OACJC,EAAU,EACVC,UAA4C,EACN;QACtC,IAAI;YACF,MAAMd,SAAS,MAAM,IAAI,CAACI,UAAU,CAACW,yBAAyB,CAC5DrB,gBAAgBsB,IAAI,CAACH;YAGvB,MAAMI,OAAO,IAAI,CAAChB,MAAM,CAACiB,kBAAkB,CACzClB,OAAOmB,YAAY,CAACC,KAAK,EACzBN;YAEF,MAAMO,gBAAgBrB,OAAOY,MAAM,CAACK;YAEpC,MAAMd,SACJ,MAAM,IAAI,CAACC,UAAU,CAACkB,wBAAwB,CAACD;YAEjD,OAAO,IAAI,CAACpB,MAAM,CAACK,+BAA+B,CAACH;QACrD,EAAE,OAAOI,OAAO;YACd,IACE;gBAAClB;gBAAqBD;gBAAqBI;aAAkB,CAACgB,QAAQ,CACpED,MAAME,WAAW,GAEnB;gBACA,MAAMF;YACR;YAEA,IAAI,CAACG,MAAM,CAACH,KAAK,CAACA;YAClB,MAAM,IAAIhB,6BAA6BgB,MAAMI,OAAO;QACtD;IACF;IA5DAF,YACE,AAASC,MAAoB,EAC7B,AAASN,UAA4B,CACrC;aAFSM,SAAAA;aACAN,aAAAA;QAET,IAAI,CAACM,MAAM,CAACa,UAAU,CAAC1B,2BAA2B2B,IAAI;QACtD,IAAI,CAACvB,MAAM,GAAG,IAAIL,yBAAyB,IAAI,CAACc,MAAM;IACxD;AAuDF"}