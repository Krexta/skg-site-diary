{"version":3,"sources":["../../../../src/application/scenario/project-close-report/parser.ts"],"sourcesContent":["import { BadRequestException } from '@nestjs/common';\n\nimport {\n  File,\n  IUpdateProjectCloseReport,\n  ProjectCloseReport,\n} from '../../../domain/entity';\nimport {\n  CloseReportChecklist,\n  CreateUserId,\n  FileName,\n  FilePath,\n  ProjectId,\n  ProjectReportId,\n  ReportText,\n  Title,\n  UploadUserId,\n  YearMonthDay,\n} from '../../../domain/value';\nimport { CustomLogger } from '../../../utility';\nimport {\n  ICreateProjectCloseReportRequest,\n  IProjectCloseReportResponse,\n  IUpdateProjectCloseReportRequest,\n} from '../../interface';\n\nexport class ProjectCloseReportParser {\n  constructor(readonly logger: CustomLogger) {}\n\n  convertToProjectReport(\n    input: ICreateProjectCloseReportRequest,\n  ): ProjectCloseReport {\n    try {\n      const id = ProjectReportId.make();\n      const createUserId = CreateUserId.make();\n      const reportDate = YearMonthDay.from(input.report_date);\n      const projectId = ProjectId.from(input.project_id);\n      const uploadUserId = UploadUserId.from(createUserId.value);\n      const files = input.attached_files.map(\n        (file) =>\n          new File({\n            name: FileName.from(file.file_name),\n            path: FilePath.from(file.file_path),\n            uploadUserId,\n          }),\n      );\n      const title = Title.from(input.title ?? null);\n      const reportText = ReportText.from(input.report_text ?? null);\n      const closeReportChecklist = CloseReportChecklist.from(\n        input.close_report_checklist,\n      );\n\n      return new ProjectCloseReport({\n        id,\n        createUserId,\n        reportDate,\n        projectId,\n        files,\n        title,\n        reportText,\n        closeReportChecklist,\n      });\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.message);\n    }\n  }\n\n  convertProjectReportToReference(\n    entity: ProjectCloseReport,\n  ): IProjectCloseReportResponse {\n    const {\n      id,\n      files,\n      projectId,\n      reportDate,\n      createUserId,\n      title,\n      reportText,\n      closeReportChecklist,\n    } = entity;\n\n    return {\n      id: id.value,\n      title: title.value ?? undefined,\n      report_text: reportText.value ?? undefined,\n      attached_files: files.map((file) => ({\n        file_name: file.name.value,\n        file_path: file.path.value,\n      })),\n      close_report_checklist: closeReportChecklist.value,\n      project_id: projectId.value,\n      report_date: reportDate.toString(),\n      create_user_id: createUserId.value,\n    };\n  }\n\n  private returnValueOrUndefined<E, T>(\n    value: E,\n    operation: (value: E) => T,\n  ): T | undefined {\n    if (value === undefined) {\n      return undefined;\n    }\n    return operation(value);\n  }\n  formatDataToUpdate(\n    userId: string,\n    data: IUpdateProjectCloseReportRequest,\n  ): IUpdateProjectCloseReport {\n    const uploadUserId = UploadUserId.from(userId);\n    return {\n      files: data.attached_files?.map(\n        (file) =>\n          new File({\n            name: FileName.from(file.file_name),\n            path: FilePath.from(file.file_path),\n            uploadUserId,\n          }),\n      ),\n      title: this.returnValueOrUndefined(data.title, Title.from),\n      reportText: this.returnValueOrUndefined(\n        data.report_text,\n        ReportText.from,\n      ),\n      closeReportChecklist: this.returnValueOrUndefined(\n        data.close_report_checklist,\n        CloseReportChecklist.from,\n      ),\n      reportDate: this.returnValueOrUndefined(\n        data.report_date,\n        YearMonthDay.from,\n      ),\n    };\n  }\n}\n"],"names":["BadRequestException","File","ProjectCloseReport","CloseReportChecklist","CreateUserId","FileName","FilePath","ProjectId","ProjectReportId","ReportText","Title","UploadUserId","YearMonthDay","ProjectCloseReportParser","convertToProjectReport","input","id","make","createUserId","reportDate","from","report_date","projectId","project_id","uploadUserId","value","files","attached_files","map","file","name","file_name","path","file_path","title","reportText","report_text","closeReportChecklist","close_report_checklist","error","logger","message","convertProjectReportToReference","entity","undefined","toString","create_user_id","returnValueOrUndefined","operation","formatDataToUpdate","userId","data","constructor"],"mappings":"AAAA,SAASA,mBAAmB,QAAQ,iBAAiB;AAErD,SACEC,IAAI,EAEJC,kBAAkB,QACb,kCAAyB;AAChC,SACEC,oBAAoB,EACpBC,YAAY,EACZC,QAAQ,EACRC,QAAQ,EACRC,SAAS,EACTC,eAAe,EACfC,UAAU,EACVC,KAAK,EACLC,YAAY,EACZC,YAAY,QACP,iCAAwB;AAQ/B,OAAO,MAAMC;IAGXC,uBACEC,KAAuC,EACnB;QACpB,IAAI;YACF,MAAMC,KAAKR,gBAAgBS,IAAI;YAC/B,MAAMC,eAAed,aAAaa,IAAI;YACtC,MAAME,aAAaP,aAAaQ,IAAI,CAACL,MAAMM,WAAW;YACtD,MAAMC,YAAYf,UAAUa,IAAI,CAACL,MAAMQ,UAAU;YACjD,MAAMC,eAAeb,aAAaS,IAAI,CAACF,aAAaO,KAAK;YACzD,MAAMC,QAAQX,MAAMY,cAAc,CAACC,GAAG,CACpC,CAACC,OACC,IAAI5B,KAAK;oBACP6B,MAAMzB,SAASe,IAAI,CAACS,KAAKE,SAAS;oBAClCC,MAAM1B,SAASc,IAAI,CAACS,KAAKI,SAAS;oBAClCT;gBACF;YAEJ,MAAMU,QAAQxB,MAAMU,IAAI,CAACL,MAAMmB,KAAK,IAAI;YACxC,MAAMC,aAAa1B,WAAWW,IAAI,CAACL,MAAMqB,WAAW,IAAI;YACxD,MAAMC,uBAAuBlC,qBAAqBiB,IAAI,CACpDL,MAAMuB,sBAAsB;YAG9B,OAAO,IAAIpC,mBAAmB;gBAC5Bc;gBACAE;gBACAC;gBACAG;gBACAI;gBACAQ;gBACAC;gBACAE;YACF;QACF,EAAE,OAAOE,OAAO;YACd,IAAI,CAACC,MAAM,CAACD,KAAK,CAACA;YAClB,MAAM,IAAIvC,oBAAoBuC,MAAME,OAAO;QAC7C;IACF;IAEAC,gCACEC,MAA0B,EACG;QAC7B,MAAM,EACJ3B,EAAE,EACFU,KAAK,EACLJ,SAAS,EACTH,UAAU,EACVD,YAAY,EACZgB,KAAK,EACLC,UAAU,EACVE,oBAAoB,EACrB,GAAGM;QAEJ,OAAO;YACL3B,IAAIA,GAAGS,KAAK;YACZS,OAAOA,MAAMT,KAAK,IAAImB;YACtBR,aAAaD,WAAWV,KAAK,IAAImB;YACjCjB,gBAAgBD,MAAME,GAAG,CAAC,CAACC,OAAU,CAAA;oBACnCE,WAAWF,KAAKC,IAAI,CAACL,KAAK;oBAC1BQ,WAAWJ,KAAKG,IAAI,CAACP,KAAK;gBAC5B,CAAA;YACAa,wBAAwBD,qBAAqBZ,KAAK;YAClDF,YAAYD,UAAUG,KAAK;YAC3BJ,aAAaF,WAAW0B,QAAQ;YAChCC,gBAAgB5B,aAAaO,KAAK;QACpC;IACF;IAEQsB,uBACNtB,KAAQ,EACRuB,SAA0B,EACX;QACf,IAAIvB,UAAUmB,WAAW;YACvB,OAAOA;QACT;QACA,OAAOI,UAAUvB;IACnB;IACAwB,mBACEC,MAAc,EACdC,IAAsC,EACX;QAC3B,MAAM3B,eAAeb,aAAaS,IAAI,CAAC8B;QACvC,OAAO;YACLxB,OAAOyB,KAAKxB,cAAc,EAAEC,IAC1B,CAACC,OACC,IAAI5B,KAAK;oBACP6B,MAAMzB,SAASe,IAAI,CAACS,KAAKE,SAAS;oBAClCC,MAAM1B,SAASc,IAAI,CAACS,KAAKI,SAAS;oBAClCT;gBACF;YAEJU,OAAO,IAAI,CAACa,sBAAsB,CAACI,KAAKjB,KAAK,EAAExB,MAAMU,IAAI;YACzDe,YAAY,IAAI,CAACY,sBAAsB,CACrCI,KAAKf,WAAW,EAChB3B,WAAWW,IAAI;YAEjBiB,sBAAsB,IAAI,CAACU,sBAAsB,CAC/CI,KAAKb,sBAAsB,EAC3BnC,qBAAqBiB,IAAI;YAE3BD,YAAY,IAAI,CAAC4B,sBAAsB,CACrCI,KAAK9B,WAAW,EAChBT,aAAaQ,IAAI;QAErB;IACF;IA3GAgC,YAAY,AAASZ,MAAoB,CAAE;aAAtBA,SAAAA;IAAuB;AA4G9C"}