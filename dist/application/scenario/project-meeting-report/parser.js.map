{"version":3,"sources":["../../../../src/application/scenario/project-meeting-report/parser.ts"],"sourcesContent":["import { BadRequestException } from '@nestjs/common';\n\nimport {\n  File,\n  IUpdateProjectMeetingReport,\n  ProjectMeetingReport,\n} from '../../../domain/entity';\nimport {\n  CreateUserId,\n  FileName,\n  FilePath,\n  ProjectId,\n  ProjectReportId,\n  ReportText,\n  Title,\n  UploadUserId,\n  YearMonthDay,\n} from '../../../domain/value';\nimport { CustomLogger } from '../../../utility';\nimport {\n  ICreateProjectMeetingReportRequest,\n  IProjectMeetingReportResponse,\n  IUpdateProjectMeetingReportRequest,\n} from '../../interface';\n\nexport class ProjectMeetingReportParser {\n  constructor(readonly logger: CustomLogger) {}\n\n  convertToProjectReport(\n    input: ICreateProjectMeetingReportRequest,\n  ): ProjectMeetingReport {\n    try {\n      const id = ProjectReportId.make();\n      const createUserId = CreateUserId.make();\n      const reportDate = YearMonthDay.from(input.report_date);\n      const projectId = ProjectId.from(input.project_id);\n      const uploadUserId = UploadUserId.from(createUserId.value);\n      const files = input.attached_files.map(\n        (file) =>\n          new File({\n            name: FileName.from(file.file_name),\n            path: FilePath.from(file.file_path),\n            uploadUserId,\n          }),\n      );\n      const title = Title.from(input.title ?? null);\n      const reportText = ReportText.from(input.report_text ?? null);\n\n      return new ProjectMeetingReport({\n        id,\n        createUserId,\n        reportDate,\n        projectId,\n        files,\n        title,\n        reportText,\n      });\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.message);\n    }\n  }\n\n  convertProjectReportToReference(\n    entity: ProjectMeetingReport,\n  ): IProjectMeetingReportResponse {\n    const {\n      id,\n      files,\n      projectId,\n      reportDate,\n      createUserId,\n      title,\n      reportText,\n    } = entity;\n\n    return {\n      id: id.value,\n      title: title.value ?? undefined,\n      report_text: reportText.value ?? undefined,\n      attached_files: files.map((file) => ({\n        file_name: file.name.value,\n        file_path: file.path.value,\n      })),\n      project_id: projectId.value,\n      report_date: reportDate.toString(),\n      create_user_id: createUserId.value,\n    };\n  }\n\n  private returnValueOrUndefined<E, T>(\n    value: E,\n    operation: (value: E) => T,\n  ): T | undefined {\n    if (value === undefined) {\n      return undefined;\n    }\n    return operation(value);\n  }\n  formatDataToUpdate(\n    userId: string,\n    data: IUpdateProjectMeetingReportRequest,\n  ): IUpdateProjectMeetingReport {\n    const uploadUserId = UploadUserId.from(userId);\n    return {\n      files: data.attached_files?.map(\n        (file) =>\n          new File({\n            name: FileName.from(file.file_name),\n            path: FilePath.from(file.file_path),\n            uploadUserId,\n          }),\n      ),\n      title: this.returnValueOrUndefined(data.title, Title.from),\n      reportText: this.returnValueOrUndefined(\n        data.report_text,\n        ReportText.from,\n      ),\n      reportDate: this.returnValueOrUndefined(\n        data.report_date,\n        YearMonthDay.from,\n      ),\n    };\n  }\n}\n"],"names":["BadRequestException","File","ProjectMeetingReport","CreateUserId","FileName","FilePath","ProjectId","ProjectReportId","ReportText","Title","UploadUserId","YearMonthDay","ProjectMeetingReportParser","convertToProjectReport","input","id","make","createUserId","reportDate","from","report_date","projectId","project_id","uploadUserId","value","files","attached_files","map","file","name","file_name","path","file_path","title","reportText","report_text","error","logger","message","convertProjectReportToReference","entity","undefined","toString","create_user_id","returnValueOrUndefined","operation","formatDataToUpdate","userId","data","constructor"],"mappings":"AAAA,SAASA,mBAAmB,QAAQ,iBAAiB;AAErD,SACEC,IAAI,EAEJC,oBAAoB,QACf,kCAAyB;AAChC,SACEC,YAAY,EACZC,QAAQ,EACRC,QAAQ,EACRC,SAAS,EACTC,eAAe,EACfC,UAAU,EACVC,KAAK,EACLC,YAAY,EACZC,YAAY,QACP,iCAAwB;AAQ/B,OAAO,MAAMC;IAGXC,uBACEC,KAAyC,EACnB;QACtB,IAAI;YACF,MAAMC,KAAKR,gBAAgBS,IAAI;YAC/B,MAAMC,eAAed,aAAaa,IAAI;YACtC,MAAME,aAAaP,aAAaQ,IAAI,CAACL,MAAMM,WAAW;YACtD,MAAMC,YAAYf,UAAUa,IAAI,CAACL,MAAMQ,UAAU;YACjD,MAAMC,eAAeb,aAAaS,IAAI,CAACF,aAAaO,KAAK;YACzD,MAAMC,QAAQX,MAAMY,cAAc,CAACC,GAAG,CACpC,CAACC,OACC,IAAI3B,KAAK;oBACP4B,MAAMzB,SAASe,IAAI,CAACS,KAAKE,SAAS;oBAClCC,MAAM1B,SAASc,IAAI,CAACS,KAAKI,SAAS;oBAClCT;gBACF;YAEJ,MAAMU,QAAQxB,MAAMU,IAAI,CAACL,MAAMmB,KAAK,IAAI;YACxC,MAAMC,aAAa1B,WAAWW,IAAI,CAACL,MAAMqB,WAAW,IAAI;YAExD,OAAO,IAAIjC,qBAAqB;gBAC9Ba;gBACAE;gBACAC;gBACAG;gBACAI;gBACAQ;gBACAC;YACF;QACF,EAAE,OAAOE,OAAO;YACd,IAAI,CAACC,MAAM,CAACD,KAAK,CAACA;YAClB,MAAM,IAAIpC,oBAAoBoC,MAAME,OAAO;QAC7C;IACF;IAEAC,gCACEC,MAA4B,EACG;QAC/B,MAAM,EACJzB,EAAE,EACFU,KAAK,EACLJ,SAAS,EACTH,UAAU,EACVD,YAAY,EACZgB,KAAK,EACLC,UAAU,EACX,GAAGM;QAEJ,OAAO;YACLzB,IAAIA,GAAGS,KAAK;YACZS,OAAOA,MAAMT,KAAK,IAAIiB;YACtBN,aAAaD,WAAWV,KAAK,IAAIiB;YACjCf,gBAAgBD,MAAME,GAAG,CAAC,CAACC,OAAU,CAAA;oBACnCE,WAAWF,KAAKC,IAAI,CAACL,KAAK;oBAC1BQ,WAAWJ,KAAKG,IAAI,CAACP,KAAK;gBAC5B,CAAA;YACAF,YAAYD,UAAUG,KAAK;YAC3BJ,aAAaF,WAAWwB,QAAQ;YAChCC,gBAAgB1B,aAAaO,KAAK;QACpC;IACF;IAEQoB,uBACNpB,KAAQ,EACRqB,SAA0B,EACX;QACf,IAAIrB,UAAUiB,WAAW;YACvB,OAAOA;QACT;QACA,OAAOI,UAAUrB;IACnB;IACAsB,mBACEC,MAAc,EACdC,IAAwC,EACX;QAC7B,MAAMzB,eAAeb,aAAaS,IAAI,CAAC4B;QACvC,OAAO;YACLtB,OAAOuB,KAAKtB,cAAc,EAAEC,IAC1B,CAACC,OACC,IAAI3B,KAAK;oBACP4B,MAAMzB,SAASe,IAAI,CAACS,KAAKE,SAAS;oBAClCC,MAAM1B,SAASc,IAAI,CAACS,KAAKI,SAAS;oBAClCT;gBACF;YAEJU,OAAO,IAAI,CAACW,sBAAsB,CAACI,KAAKf,KAAK,EAAExB,MAAMU,IAAI;YACzDe,YAAY,IAAI,CAACU,sBAAsB,CACrCI,KAAKb,WAAW,EAChB3B,WAAWW,IAAI;YAEjBD,YAAY,IAAI,CAAC0B,sBAAsB,CACrCI,KAAK5B,WAAW,EAChBT,aAAaQ,IAAI;QAErB;IACF;IAjGA8B,YAAY,AAASZ,MAAoB,CAAE;aAAtBA,SAAAA;IAAuB;AAkG9C"}