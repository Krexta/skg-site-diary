{"version":3,"sources":["../../../../src/application/scenario/project-budget-change/parser.ts"],"sourcesContent":["import { BadRequestException } from '@nestjs/common';\n\nimport {\n  File,\n  IUpdateProjectBudgetChange,\n  ProjectBudgetChange,\n} from '../../../domain/entity';\nimport {\n  BillingClientId,\n  ChangeReasonCode,\n  CreateUserId,\n  FileName,\n  FilePath,\n  ProjectId,\n  ProjectReportId,\n  ReportText,\n  Title,\n  UploadUserId,\n  YearMonthDay,\n} from '../../../domain/value';\nimport { CustomLogger } from '../../../utility';\nimport {\n  ICreateProjectBudgetChangeRequest,\n  IProjectBudgetChangeResponse,\n  IUpdateProjectBudgetChangeRequest,\n} from '../../interface';\n\nexport class ProjectBudgetChangeParser {\n  constructor(readonly logger: CustomLogger) {}\n\n  convertToProjectReport(\n    input: ICreateProjectBudgetChangeRequest,\n  ): ProjectBudgetChange {\n    try {\n      const id = ProjectReportId.make();\n      const createUserId = CreateUserId.make();\n      const reportDate = YearMonthDay.from(input.report_date);\n      const projectId = ProjectId.from(input.project_id);\n      const uploadUserId = UploadUserId.from(createUserId.value);\n      const files = input.attached_files.map(\n        (file) =>\n          new File({\n            name: FileName.from(file.file_name),\n            path: FilePath.from(file.file_path),\n            uploadUserId,\n          }),\n      );\n      const title = Title.from(input.title ?? null);\n      const reportText = ReportText.from(input.report_text ?? null);\n      const changeReasonCode = ChangeReasonCode.from(input.change_reason_code);\n      const billingClientId = BillingClientId.from(input.billing_client_id);\n\n      return new ProjectBudgetChange({\n        id,\n        createUserId,\n        reportDate,\n        projectId,\n        files,\n        title,\n        reportText,\n        changeReasonCode,\n        billingClientId,\n      });\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.message);\n    }\n  }\n\n  convertProjectBudgetChangeToReference(\n    entity: ProjectBudgetChange,\n  ): IProjectBudgetChangeResponse {\n    const {\n      id,\n      files,\n      projectId,\n      reportDate,\n      createUserId,\n      title,\n      reportText,\n      changeReasonCode,\n      billingClientId,\n    } = entity;\n\n    return {\n      id: id.value,\n      title: title.value ?? undefined,\n      report_text: reportText.value ?? undefined,\n      attached_files: files.map((file) => ({\n        file_name: file.name.value,\n        file_path: file.path.value,\n      })),\n      change_reason_code: changeReasonCode.value,\n      billing_client_id: billingClientId.value,\n      project_id: projectId.value,\n      report_date: reportDate.toString(),\n      create_user_id: createUserId.value,\n    };\n  }\n\n  private returnValueOrUndefined<E, T>(\n    value: E,\n    operation: (value: E) => T,\n  ): T | undefined {\n    if (value === undefined) {\n      return undefined;\n    }\n    return operation(value);\n  }\n  formatDataToUpdate(\n    userId: string,\n    data: IUpdateProjectBudgetChangeRequest,\n  ): IUpdateProjectBudgetChange {\n    const uploadUserId = UploadUserId.from(userId);\n    return {\n      files: data.attached_files?.map(\n        (file) =>\n          new File({\n            name: FileName.from(file.file_name),\n            path: FilePath.from(file.file_path),\n            uploadUserId,\n          }),\n      ),\n\n      title: this.returnValueOrUndefined(data.title, Title.from),\n      reportText: this.returnValueOrUndefined(\n        data.report_text,\n        ReportText.from,\n      ),\n      changeReasonCode: this.returnValueOrUndefined(\n        data.change_reason_code,\n        ChangeReasonCode.from,\n      ),\n      billingClientId: this.returnValueOrUndefined(\n        data.billing_client_id,\n        BillingClientId.from,\n      ),\n\n      reportDate: this.returnValueOrUndefined(\n        data.report_date,\n        YearMonthDay.from,\n      ),\n    };\n  }\n}\n"],"names":["BadRequestException","File","ProjectBudgetChange","BillingClientId","ChangeReasonCode","CreateUserId","FileName","FilePath","ProjectId","ProjectReportId","ReportText","Title","UploadUserId","YearMonthDay","ProjectBudgetChangeParser","convertToProjectReport","input","id","make","createUserId","reportDate","from","report_date","projectId","project_id","uploadUserId","value","files","attached_files","map","file","name","file_name","path","file_path","title","reportText","report_text","changeReasonCode","change_reason_code","billingClientId","billing_client_id","error","logger","message","convertProjectBudgetChangeToReference","entity","undefined","toString","create_user_id","returnValueOrUndefined","operation","formatDataToUpdate","userId","data","constructor"],"mappings":"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"}