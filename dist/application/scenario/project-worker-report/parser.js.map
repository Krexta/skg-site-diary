{"version":3,"sources":["../../../../src/application/scenario/project-worker-report/parser.ts"],"sourcesContent":["import { BadRequestException } from '@nestjs/common';\n\nimport {\n  File,\n  IUpdateProjectWorkerReport,\n  ProjectWorkerReport,\n} from '../../../domain/entity';\nimport {\n  CreateUserId,\n  FileName,\n  FilePath,\n  ProjectId,\n  ProjectReportId,\n  ReportText,\n  ReportTypeCode,\n  Title,\n  UploadUserId,\n  WorkerId,\n  YearMonthDay,\n} from '../../../domain/value';\nimport { CustomLogger } from '../../../utility';\nimport {\n  ICreateProjectWorkerReportRequest,\n  IProjectWorkerReportResponse,\n  IUpdateProjectWorkerReportRequest,\n} from '../../interface';\n\nexport class ProjectWorkerReportParser {\n  constructor(readonly logger: CustomLogger) {}\n\n  convertToProjectReport(\n    input: ICreateProjectWorkerReportRequest,\n  ): ProjectWorkerReport {\n    try {\n      const id = ProjectReportId.make();\n      const createUserId = CreateUserId.make();\n      const reportDate = YearMonthDay.from(input.report_date);\n      const projectId = ProjectId.from(input.project_id);\n      const uploadUserId = UploadUserId.from(createUserId.value);\n      const files = input.attached_files.map(\n        (file) =>\n          new File({\n            name: FileName.from(file.file_name),\n            path: FilePath.from(file.file_path),\n            uploadUserId,\n          }),\n      );\n      const title = Title.from(input.title ?? null);\n      const reportText = ReportText.from(input.report_text ?? null);\n      const reportTypeCode = ReportTypeCode.from(\n        input.report_type_code ?? null,\n      );\n      const workerIds = input.reported_worker_ids.map((id) =>\n        WorkerId.from(id),\n      );\n\n      return new ProjectWorkerReport({\n        id,\n        createUserId,\n        reportDate,\n        projectId,\n        files,\n        title,\n        reportText,\n        reportTypeCode,\n        workerIds,\n      });\n    } catch (error) {\n      this.logger.error(error);\n      throw new BadRequestException(error.message);\n    }\n  }\n\n  convertProjectReportToReference(\n    entity: ProjectWorkerReport,\n  ): IProjectWorkerReportResponse {\n    const {\n      id,\n      files,\n      projectId,\n      reportDate,\n      createUserId,\n      title,\n      reportText,\n      reportTypeCode,\n      workerIds,\n    } = entity;\n\n    return {\n      id: id.value,\n      title: title.value ?? undefined,\n      report_text: reportText.value ?? undefined,\n      attached_files: files.map((file) => ({\n        file_name: file.name.value,\n        file_path: file.path.value,\n      })),\n      report_date: reportDate.toString(),\n      create_user_id: createUserId.value,\n      report_type_code: reportTypeCode.value ?? undefined,\n      reported_worker_ids: workerIds.map((id) => id.value),\n      project_id: projectId.value,\n    };\n  }\n  private returnValueOrUndefined<E, T>(\n    value: E,\n    operation: (value: E) => T,\n  ): T | undefined {\n    if (value === undefined) {\n      return undefined;\n    }\n    return operation(value);\n  }\n  formatDataToUpdate(\n    userId: string,\n    data: IUpdateProjectWorkerReportRequest,\n  ): IUpdateProjectWorkerReport {\n    const uploadUserId = UploadUserId.from(userId);\n    return {\n      files: data.attached_files?.map(\n        (file) =>\n          new File({\n            name: FileName.from(file.file_name),\n            path: FilePath.from(file.file_path),\n            uploadUserId,\n          }),\n      ),\n      title: this.returnValueOrUndefined(data.title, Title.from),\n      reportText: this.returnValueOrUndefined(\n        data.report_text,\n        ReportText.from,\n      ),\n      reportTypeCode: this.returnValueOrUndefined(\n        data.report_type_code,\n        ReportTypeCode.from,\n      ),\n      workerIds: data.reported_worker_ids?.map(WorkerId.from),\n      reportDate: this.returnValueOrUndefined(\n        data.report_date,\n        YearMonthDay.from,\n      ),\n    };\n  }\n}\n"],"names":["BadRequestException","File","ProjectWorkerReport","CreateUserId","FileName","FilePath","ProjectId","ProjectReportId","ReportText","ReportTypeCode","Title","UploadUserId","WorkerId","YearMonthDay","ProjectWorkerReportParser","convertToProjectReport","input","id","make","createUserId","reportDate","from","report_date","projectId","project_id","uploadUserId","value","files","attached_files","map","file","name","file_name","path","file_path","title","reportText","report_text","reportTypeCode","report_type_code","workerIds","reported_worker_ids","error","logger","message","convertProjectReportToReference","entity","undefined","toString","create_user_id","returnValueOrUndefined","operation","formatDataToUpdate","userId","data","constructor"],"mappings":"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"}