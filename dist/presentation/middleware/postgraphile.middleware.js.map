{"version":3,"sources":["../../../src/presentation/middleware/postgraphile.middleware.ts"],"sourcesContent":["// cSpell:word graphile inflector errcode graphiql setof diaryql\nimport PgSimplifyInflectorPlugin from '@graphile-contrib/pg-simplify-inflector';\nimport { PgEntityKind } from 'graphile-build-pg';\nimport { makePgSmartTagsPlugin } from 'graphile-utils/node8plus/makePgSmartTagsPlugin.js';\nimport { postgraphile } from 'postgraphile';\nimport ConnectionFilterPlugin from 'postgraphile-plugin-connection-filter';\n\nimport { AppConfig } from 'src/utility';\n\nconst SmartTagsPlugin = makePgSmartTagsPlugin([\n  {\n    kind: PgEntityKind.CLASS,\n    match: '_prisma_migrations',\n    tags: {\n      omit: 'read,update,create,delete,all,many',\n    },\n  },\n  {\n    kind: PgEntityKind.CLASS,\n    match: 'Event',\n    tags: {\n      omit: 'read,update,create,delete,all,many',\n    },\n  },\n]);\n\nconst development_options = {\n  subscriptions: true,\n  watchPg: true,\n  dynamicJson: true,\n  setofFunctionsContainNulls: false,\n  ignoreRBAC: false,\n  showErrorStack: 'json' as const,\n  extendedErrors: ['hint', 'detail', 'errcode'],\n  appendPlugins: [\n    PgSimplifyInflectorPlugin,\n    SmartTagsPlugin,\n    ConnectionFilterPlugin,\n  ],\n  exportGqlSchemaPath: 'doc/graphql/schema.graphql',\n  graphiql: true,\n  enhanceGraphiql: true,\n  enableQueryBatching: true,\n  legacyRelations: 'omit' as const,\n  disableDefaultMutations: true, // Mutationを自動生成しない\n  graphqlRoute: '/diaryql',\n};\n\nconst production_options = {\n  subscriptions: true,\n  retryOnInitFail: true,\n  dynamicJson: true,\n  setofFunctionsContainNulls: false,\n  ignoreRBAC: false,\n  extendedErrors: ['errcode'],\n  appendPlugins: [\n    PgSimplifyInflectorPlugin,\n    SmartTagsPlugin,\n    ConnectionFilterPlugin,\n  ],\n  graphiql: false,\n  enableQueryBatching: true,\n  disableQueryLog: true,\n  legacyRelations: 'omit' as const,\n  disableDefaultMutations: true, // Mutationを自動生成しない\n  graphqlRoute: '/diaryql',\n};\n\nexport const middleware = postgraphile(\n  process.env.DATABASE_URL,\n  'public',\n  AppConfig.switchGraphileConfig(development_options, production_options),\n);\n"],"names":["PgSimplifyInflectorPlugin","PgEntityKind","makePgSmartTagsPlugin","postgraphile","ConnectionFilterPlugin","AppConfig","SmartTagsPlugin","kind","CLASS","match","tags","omit","development_options","subscriptions","watchPg","dynamicJson","setofFunctionsContainNulls","ignoreRBAC","showErrorStack","extendedErrors","appendPlugins","exportGqlSchemaPath","graphiql","enhanceGraphiql","enableQueryBatching","legacyRelations","disableDefaultMutations","graphqlRoute","production_options","retryOnInitFail","disableQueryLog","middleware","process","env","DATABASE_URL","switchGraphileConfig"],"mappings":"AAAA,gEAAgE;AAChE,OAAOA,+BAA+B,0CAA0C;AAChF,SAASC,YAAY,QAAQ,oBAAoB;AACjD,SAASC,qBAAqB,QAAQ,oDAAoD;AAC1F,SAASC,YAAY,QAAQ,eAAe;AAC5C,OAAOC,4BAA4B,wCAAwC;AAE3E,SAASC,SAAS,QAAQ,yBAAc;AAExC,MAAMC,kBAAkBJ,sBAAsB;IAC5C;QACEK,MAAMN,aAAaO,KAAK;QACxBC,OAAO;QACPC,MAAM;YACJC,MAAM;QACR;IACF;IACA;QACEJ,MAAMN,aAAaO,KAAK;QACxBC,OAAO;QACPC,MAAM;YACJC,MAAM;QACR;IACF;CACD;AAED,MAAMC,sBAAsB;IAC1BC,eAAe;IACfC,SAAS;IACTC,aAAa;IACbC,4BAA4B;IAC5BC,YAAY;IACZC,gBAAgB;IAChBC,gBAAgB;QAAC;QAAQ;QAAU;KAAU;IAC7CC,eAAe;QACbpB;QACAM;QACAF;KACD;IACDiB,qBAAqB;IACrBC,UAAU;IACVC,iBAAiB;IACjBC,qBAAqB;IACrBC,iBAAiB;IACjBC,yBAAyB;IACzBC,cAAc;AAChB;AAEA,MAAMC,qBAAqB;IACzBf,eAAe;IACfgB,iBAAiB;IACjBd,aAAa;IACbC,4BAA4B;IAC5BC,YAAY;IACZE,gBAAgB;QAAC;KAAU;IAC3BC,eAAe;QACbpB;QACAM;QACAF;KACD;IACDkB,UAAU;IACVE,qBAAqB;IACrBM,iBAAiB;IACjBL,iBAAiB;IACjBC,yBAAyB;IACzBC,cAAc;AAChB;AAEA,OAAO,MAAMI,aAAa5B,aACxB6B,QAAQC,GAAG,CAACC,YAAY,EACxB,UACA7B,UAAU8B,oBAAoB,CAACvB,qBAAqBgB,qBACpD"}