{"version":3,"sources":["../../../src/presentation/middleware/tracker.middleware.ts"],"sourcesContent":["import { Injectable, Logger, NestMiddleware } from '@nestjs/common';\n\nimport type { NextFunction, Request, Response } from 'express';\n\n@Injectable()\nexport class TrackerMiddleware implements NestMiddleware {\n  private readonly logger = new Logger('HTTP');\n\n  use(req: Request, res: Response, next: NextFunction) {\n    const { ip, method, originalUrl, body } = req;\n    const start = Date.now();\n\n    this.logger.log(\n      `[Request] ${ip} ${method} ${originalUrl} ${JSON.stringify(body)}`,\n    );\n\n    const oldJson = res.json;\n    res.json = (body) => {\n      res.locals.body = JSON.stringify(body);\n      return oldJson.call(res, body);\n    };\n\n    res.on('finish', () => {\n      const {\n        statusCode,\n        locals: { body },\n      } = res;\n      const elapsed = Date.now() - start;\n\n      this.logger.log(\n        `[Response] ${ip} ${method} ${originalUrl} ${statusCode} ${body ?? ''} ${elapsed}ms`,\n      );\n    });\n\n    next();\n  }\n}\n"],"names":["Injectable","Logger","TrackerMiddleware","use","req","res","next","ip","method","originalUrl","body","start","Date","now","logger","log","JSON","stringify","oldJson","json","locals","call","on","statusCode","elapsed"],"mappings":";;;;;;AAAA,SAASA,UAAU,EAAEC,MAAM,QAAwB,iBAAiB;AAKpE,OAAO,MAAMC;IAGXC,IAAIC,GAAY,EAAEC,GAAa,EAAEC,IAAkB,EAAE;QACnD,MAAM,EAAEC,EAAE,EAAEC,MAAM,EAAEC,WAAW,EAAEC,IAAI,EAAE,GAAGN;QAC1C,MAAMO,QAAQC,KAAKC,GAAG;QAEtB,IAAI,CAACC,MAAM,CAACC,GAAG,CACb,CAAC,UAAU,EAAER,GAAG,CAAC,EAAEC,OAAO,CAAC,EAAEC,YAAY,CAAC,EAAEO,KAAKC,SAAS,CAACP,OAAO;QAGpE,MAAMQ,UAAUb,IAAIc,IAAI;QACxBd,IAAIc,IAAI,GAAG,CAACT;YACVL,IAAIe,MAAM,CAACV,IAAI,GAAGM,KAAKC,SAAS,CAACP;YACjC,OAAOQ,QAAQG,IAAI,CAAChB,KAAKK;QAC3B;QAEAL,IAAIiB,EAAE,CAAC,UAAU;YACf,MAAM,EACJC,UAAU,EACVH,QAAQ,EAAEV,IAAI,EAAE,EACjB,GAAGL;YACJ,MAAMmB,UAAUZ,KAAKC,GAAG,KAAKF;YAE7B,IAAI,CAACG,MAAM,CAACC,GAAG,CACb,CAAC,WAAW,EAAER,GAAG,CAAC,EAAEC,OAAO,CAAC,EAAEC,YAAY,CAAC,EAAEc,WAAW,CAAC,EAAEb,QAAQ,GAAG,CAAC,EAAEc,QAAQ,EAAE,CAAC;QAExF;QAEAlB;IACF;;aA7BiBQ,SAAS,IAAIb,OAAO;;AA8BvC"}